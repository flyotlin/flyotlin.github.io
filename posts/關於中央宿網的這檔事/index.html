<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>關於中央宿網的這檔事 | flyotlin's Blog</title><meta name=keywords content><meta name=description content="從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。 這次剛好在註冊、開通的過程遇到了些問題，"><meta name=author content><link rel=canonical href=https://flyotlin.github.io/posts/%E9%97%9C%E6%96%BC%E4%B8%AD%E5%A4%AE%E5%AE%BF%E7%B6%B2%E7%9A%84%E9%80%99%E6%AA%94%E4%BA%8B/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://flyotlin.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://flyotlin.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://flyotlin.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://flyotlin.github.io/apple-touch-icon.png><link rel=mask-icon href=https://flyotlin.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="關於中央宿網的這檔事"><meta property="og:description" content="從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。 這次剛好在註冊、開通的過程遇到了些問題，"><meta property="og:type" content="article"><meta property="og:url" content="https://flyotlin.github.io/posts/%E9%97%9C%E6%96%BC%E4%B8%AD%E5%A4%AE%E5%AE%BF%E7%B6%B2%E7%9A%84%E9%80%99%E6%AA%94%E4%BA%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-21T17:34:06+08:00"><meta property="article:modified_time" content="2022-05-21T17:34:06+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="關於中央宿網的這檔事"><meta name=twitter:description content="從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。 這次剛好在註冊、開通的過程遇到了些問題，"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://flyotlin.github.io/posts/"},{"@type":"ListItem","position":2,"name":"關於中央宿網的這檔事","item":"https://flyotlin.github.io/posts/%E9%97%9C%E6%96%BC%E4%B8%AD%E5%A4%AE%E5%AE%BF%E7%B6%B2%E7%9A%84%E9%80%99%E6%AA%94%E4%BA%8B/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"關於中央宿網的這檔事","name":"關於中央宿網的這檔事","description":"從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。 這次剛好在註冊、開通的過程遇到了些問題，","keywords":[],"articleBody":"從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。\n這次剛好在註冊、開通的過程遇到了些問題，就順手分享除錯過程，以及我對整個宿網運作機制的猜測及理解。\n沒辦法連上網路 起初對這個問題，做了幾個可能發生的假設。\nMAC address 填錯 Port number (A, B, C, D) 填錯 第 1 點是不可能的，畢竟從大一就用到現在。第 2 點在詢問後，也發現其實 port number 一點都不重要 ==。\n就在萬念俱灰之際，剛好逛到分享器設定頁面，發現外網 ip 怎麼不是 140.115.xxx.xxx！\n原本的假設是將分享器設定自動取得 IP (DHCP) 後，應該就會自動把 IP 設定為 140.115.xxx.xxx。但事與願違，只好手動觸發自動 IP 設定精靈，才解決了連線的問題。\nDHCP 在講宿網怎麼運作前，先來聊聊 DHCP。在古老的時代，終端設備要連上網路都只能透過手動設定 IP, Netmask, Gateway, DNS。\n於是就誕生了 DHCP，只要連上網路，就會自動設定 IP。\n連上網路的終端設備 (電腦) 會向整個網路發出 DHCP request 的廣播封包，裡面會包含設備的 MAC address。\n接著網路上的 DHCP server 收到這個封包，自動分配一個可用的 IP，並且將 IP 及相關的 netmask, gateway, DNS 夾帶在 DHCP response 封包中。\n最後，當設備收到 response 封包後，就能根據封包中資訊，正確設定網路的連線資訊。\nDHCP server 除了隨機自動分配可用 IP 外，也能夠幫特定設備 (以 MAC address 辨識) 保留一組 IP，MAC address 與 IP 的 mapping 則會記錄在 DHCP server 上的 reservation list。\n詳細還有關於 reservation list lease (租約) 過期的問題，推薦參考：\nDHCP Explained - Dynamic Host Configuration Protocol 動態主機設定協定 宿網的註冊 以下都是我的自行推論，有可能實際上並不是這麼運作。\n當你購買宿網授權，並且正確填入 MAC address 後，系統會分配一個 140.115.xxx.xxx 給你。\n同時，也會在校內網路 DHCP server 的 reservation list 紀錄分配的 140.115.xxx.xxx 要對應到你填的 MAC address。\n你的設備連上宿網後，會在校內網路發送 DHCP 的 request 廣播封包。被 DHCP server 收到後，根據 reservation list 的資訊，把你分配到的 IP 140.115.xxx.xxx 回傳給你。你的設備就能透過 DHCP response 的資訊正確上網了。\n宿網的阻擋機制 那宿網是怎麼阻擋沒有註冊的人使用網路呢？我的猜測是藉由 reservation list 中 IP 與 MAC address 的對應。\n當你要連到外部網路時，request 封包會通過校內網路的 gateway。學校計中或許在 gateway 的防火牆設置了 MAC address filter，過濾掉 IP 跟 MAC address 對應不起來的封包，進而實現了阻擋沒購買的人使用宿網。\n結語 我猜只要能夠偽造某個 IP 註冊的 MAC address，應該就能免費使用宿網了！\n但… 恩，當我沒說 XD\n","wordCount":"972","inLanguage":"en","datePublished":"2022-05-21T17:34:06+08:00","dateModified":"2022-05-21T17:34:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://flyotlin.github.io/posts/%E9%97%9C%E6%96%BC%E4%B8%AD%E5%A4%AE%E5%AE%BF%E7%B6%B2%E7%9A%84%E9%80%99%E6%AA%94%E4%BA%8B/"},"publisher":{"@type":"Organization","name":"flyotlin's Blog","logo":{"@type":"ImageObject","url":"https://flyotlin.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://flyotlin.github.io/ accesskey=h title="flyotlin's Blog (Alt + H)">flyotlin's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://flyotlin.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://flyotlin.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://flyotlin.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://flyotlin.github.io/about/ title=About><span>About</span></a></li><li><a href=https://flyotlin.github.io/cv/ title=CV><span>CV</span></a></li><li><a href=https://flyotlin.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>關於中央宿網的這檔事</h1><div class=post-meta><span title='2022-05-21 17:34:06 +0800 +0800'>2022-05-21</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%b2%92%e8%be%a6%e6%b3%95%e9%80%a3%e4%b8%8a%e7%b6%b2%e8%b7%af aria-label=沒辦法連上網路>沒辦法連上網路</a></li><li><a href=#dhcp aria-label=DHCP>DHCP</a></li><li><a href=#%e5%ae%bf%e7%b6%b2%e7%9a%84%e8%a8%bb%e5%86%8a aria-label=宿網的註冊>宿網的註冊</a></li><li><a href=#%e5%ae%bf%e7%b6%b2%e7%9a%84%e9%98%bb%e6%93%8b%e6%a9%9f%e5%88%b6 aria-label=宿網的阻擋機制>宿網的阻擋機制</a></li><li><a href=#%e7%b5%90%e8%aa%9e aria-label=結語>結語</a></li></ul></div></details></div><div class=post-content><p>從大一到大三，一直都很好奇宿舍網路的註冊及運作機制。但每次開通成功後，想要繼續深究的動力就直接消失。</p><p>這次剛好在註冊、開通的過程遇到了些問題，就順手分享除錯過程，以及我對整個宿網運作機制的猜測及理解。</p><p><img loading=lazy src=/%e5%ae%bf%e8%88%8d%e7%b6%b2%e8%b7%af.png alt=宿舍網路></p><h2 id=沒辦法連上網路>沒辦法連上網路<a hidden class=anchor aria-hidden=true href=#沒辦法連上網路>#</a></h2><p>起初對這個問題，做了幾個可能發生的假設。</p><ol><li>MAC address 填錯</li><li>Port number (A, B, C, D) 填錯</li></ol><p>第 1 點是不可能的，畢竟從大一就用到現在。第 2 點在詢問後，也發現其實 port number 一點都不重要 ==。</p><p>就在萬念俱灰之際，剛好逛到分享器設定頁面，發現外網 ip 怎麼不是 <code>140.115.xxx.xxx</code>！</p><p>原本的假設是將分享器設定自動取得 IP (DHCP) 後，應該就會自動把 IP 設定為 <code>140.115.xxx.xxx</code>。但事與願違，只好手動觸發自動 IP 設定精靈，才解決了連線的問題。</p><h2 id=dhcp>DHCP<a hidden class=anchor aria-hidden=true href=#dhcp>#</a></h2><p>在講宿網怎麼運作前，先來聊聊 DHCP。在古老的時代，終端設備要連上網路都只能透過手動設定 IP, Netmask, Gateway, DNS。</p><p>於是就誕生了 DHCP，只要連上網路，就會自動設定 IP。</p><p><img loading=lazy src=/dhcp-diagram.png alt="DHCP diagram"></p><p>連上網路的終端設備 (電腦) 會向整個網路發出 DHCP request 的廣播封包，裡面會包含設備的 MAC address。</p><p>接著網路上的 DHCP server 收到這個封包，自動分配一個可用的 IP，並且將 IP 及相關的 netmask, gateway, DNS 夾帶在 DHCP response 封包中。</p><p>最後，當設備收到 response 封包後，就能根據封包中資訊，正確設定網路的連線資訊。</p><p>DHCP server 除了隨機自動分配可用 IP 外，也能夠幫特定設備 (以 MAC address 辨識) 保留一組 IP，MAC address 與 IP 的 mapping 則會記錄在 DHCP server 上的 <strong>reservation list</strong>。</p><p>詳細還有關於 reservation list lease (租約) 過期的問題，推薦參考：</p><ul><li><a href="https://www.youtube.com/watch?v=e6-TaH5bkjo">DHCP Explained - Dynamic Host Configuration Protocol</a></li><li><a href=https://zh.wikipedia.org/zh-tw/%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E8%AE%BE%E7%BD%AE%E5%8D%8F%E8%AE%AE>動態主機設定協定</a></li></ul><h2 id=宿網的註冊>宿網的註冊<a hidden class=anchor aria-hidden=true href=#宿網的註冊>#</a></h2><blockquote><p>以下都是我的自行推論，有可能實際上並不是這麼運作。</p></blockquote><p>當你購買宿網授權，並且正確填入 MAC address 後，系統會分配一個 <code>140.115.xxx.xxx</code> 給你。</p><p>同時，也會在校內網路 DHCP server 的 reservation list 紀錄分配的 <code>140.115.xxx.xxx</code> 要對應到你填的 MAC address。</p><p>你的設備連上宿網後，會在校內網路發送 DHCP 的 request 廣播封包。被 DHCP server 收到後，根據 reservation list 的資訊，把你分配到的 IP <code>140.115.xxx.xxx</code> 回傳給你。你的設備就能透過 DHCP response 的資訊正確上網了。</p><h2 id=宿網的阻擋機制>宿網的阻擋機制<a hidden class=anchor aria-hidden=true href=#宿網的阻擋機制>#</a></h2><p>那宿網是怎麼阻擋沒有註冊的人使用網路呢？我的猜測是藉由 reservation list 中 IP 與 MAC address 的對應。</p><p>當你要連到外部網路時，request 封包會通過校內網路的 gateway。學校計中或許在 gateway 的防火牆設置了 MAC address filter，過濾掉 IP 跟 MAC address 對應不起來的封包，進而實現了阻擋沒購買的人使用宿網。</p><h2 id=結語>結語<a hidden class=anchor aria-hidden=true href=#結語>#</a></h2><p>我猜只要能夠偽造某個 IP 註冊的 MAC address，應該就能免費使用宿網了！</p><p>但&mldr;
<img loading=lazy src=/ip-banning.png alt>
恩，當我沒說 XD</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://flyotlin.github.io/>flyotlin's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>